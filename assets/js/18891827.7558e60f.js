"use strict";(self.webpackChunk_agoralabs_sh_avm_web_provider=self.webpackChunk_agoralabs_sh_avm_web_provider||[]).push([[160],{8052:function(e,n,s){s.r(n),s.d(n,{assets:function(){return m},contentTitle:function(){return p},default:function(){return w},frontMatter:function(){return h},metadata:function(){return g},toc:function(){return u}});var i=s(7624),t=s(4552),r=s(6200);s(1504);const o="container_xnVI",a="container__outer_UJ5y";var d=s(5456);const l=function(e){var n=e.label,s=e.maxWidth,t=void 0===s?"400px":s,r=e.src;return(0,i.jsx)("div",{className:(0,d.c)(o,a),children:(0,i.jsx)("div",{className:o,style:{maxWidth:t},children:(0,i.jsx)("img",{alt:n,"aria-label":n,src:r})})})},c=s.p+"assets/images/simple_message_bus-502c8c318d1b40b73ea9e5bd470c3b2a.png",h={slug:"/"},p="Overview",g={id:"overview",title:"Overview",description:"<TOCInline",source:"@site/docs/overview.mdx",sourceDirName:".",slug:"/",permalink:"/",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{slug:"/"},sidebar:"docs",next:{title:"Terminology",permalink:"/terminology"}},m={},u=[{value:"Introduction",id:"introduction",level:2},{value:"How it works",id:"how-it-works",level:2}];function v(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",ul:"ul",...(0,t.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"overview",children:"Overview"}),"\n","\n","\n","\n","\n",(0,i.jsx)(r.c,{maxHeadingLevel:4,toc:u}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"The AVM Web Provider is an interface that bridges the gap between clients (e.g. dApps) and providers (e.g. wallets), allowing clients to connect and interact with providers in a standardized way."}),"\n",(0,i.jsx)(n.p,{children:"The AVM Web Provider works towards achieving three main goals:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Creating a common interface between clients and providers."}),"\n",(0,i.jsx)(n.li,{children:"Allowing clients to choose what provider to use."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,i.jsx)(n.p,{children:'Traditionally, web-based providers inject script into a web page\'s document and "hijack" a property on the global object. This can be problematic for a user that may use multiple providers and could lead to provider B overwriting this global property that was already initialized by provider A.'}),"\n",(0,i.jsxs)(n.p,{children:["It is also common for web-based providers to use injected code to use the ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",children:(0,i.jsx)(n.code,{children:"window.postMessage"})})," for  communication to the extension's content scripts. This opens up a client to cross-origin communication; any messages sent to via ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",children:(0,i.jsx)(n.code,{children:"window.postMessage"})})," can be received by a page, and a pop-up that it spawned, or between a page and an iframe embedded within it."]}),"\n",(0,i.jsxs)(n.p,{children:["As of March 2022, the ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel",children:(0,i.jsx)(n.code,{children:"BroadcastChannel"})})," API is fully supported by all major browsers and is a clean and efficient way to broadcast/listen for messages. It provides several advantages over ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",children:(0,i.jsx)(n.code,{children:"window.postMessage"})}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["It provides a higher-level abstraction for communication. It is simpler to use compared to manually injecting scripts and handling ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",children:(0,i.jsx)(n.code,{children:"window.postMessage"})})," events."]}),"\n",(0,i.jsx)(n.li,{children:"It is limited to a named channel and the same origin, meaning only the origin page, the client, and the browsing context (for instance, a web extension's content script) can broadcast/listen to messages."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The AVM Web Provider leverages the ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel",children:(0,i.jsx)(n.code,{children:"BroadcastChannel"})})," API as a transport layer to deliver messages and allows clients and web-based providers to securely communicate without interfering with other providers."]}),"\n",(0,i.jsx)(n.p,{children:"A client will broadcast a message and the provider(s) will listen for these broadcasted messages and act upon them, responding with another broadcast message that references the original request broadcast."}),"\n",(0,i.jsx)(n.p,{children:"The client will, itself, listen to broadcasted responses from any provider(s). Below is a diagram demonstrating a web extension provider for the flow of data for an enable request."}),"\n",(0,i.jsx)(l,{label:"Diagram of a simple message bus using the BroadcastChannel API",maxWidth:"100%",src:c})]})}function w(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(v,{...e})}):v(e)}}}]);